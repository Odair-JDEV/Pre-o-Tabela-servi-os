<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>Planos e ServiÃ§os - CÃ¡lculo</title>
<style>
  body {
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #0d1b2a, #1b263b, #274060);
    color: #fff;
    min-height: 100vh;
  }

  .box {
    background: rgba(255, 255, 255, 0.12);
    border-radius: 16px;
    padding: 20px;
    margin: 20px auto;
    max-width: 900px;
    backdrop-filter: blur(12px) saturate(160%);
    -webkit-backdrop-filter: blur(12px) saturate(160%);
    border: 1px solid rgba(255, 255, 255, 0.25);
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  }

  header {
    background: rgba(255,255,255,0.15);
    padding: 24px;
    border-radius: 20px;
    text-align: center;
  }

  h1 {
    margin: 0;
    font-size: 26px;
    font-weight: 700;
    color: #fff;
  }

  h2 {
    color: #a9d6ff;
    border-bottom: 2px solid rgba(255,255,255,0.2);
    padding-bottom: 8px;
    margin-top: 30px;
  }

  .item {
    padding: 14px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.3s;
  }

  .item:hover {
    background: rgba(255,255,255,0.08);
    border-radius: 12px;
  }

  .precos {
    font-size: 15px;
    color: #dbeafe;
  }

  .btn {
    background: linear-gradient(135deg, #1e40af, #3b82f6);
    color: #fff;
    padding: 10px 18px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 14px rgba(0,0,0,0.3);
  }

  #total {
    font-size: 20px;
    font-weight: bold;
    color: #e0f2fe;
    text-align: center;
  }

  .error {
    color: #fca5a5;
    font-weight: 700;
    padding: 12px;
    border-radius: 10px;
    background: rgba(255, 0, 0, 0.15);
  }

  select {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    font-weight: 600;
    background: rgba(255,255,255,0.15);
    color: #fff;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    cursor: pointer;
  }

  select option {
    background: #1b263b;
    color: #fff;
    font-weight: 500;
  }

  input[type="checkbox"] {
    accent-color: #38bdf8;
    transform: scale(1.2);
    margin-right: 8px;
  }
</style>
</head>
<body>
<header class="box">
  <h1>Planos e ServiÃ§os</h1>
  <small>Escolha 1 plano + serviÃ§os digitais</small>
  <div style="margin-top:15px">
    <button class="btn" onclick="carregarCSV()">ðŸ”„ Atualizar</button>
    <span id="last" style="margin-left:12px;color:#dbeafe"></span>
  </div>
</header>

<div id="saida" class="box">Carregando...</div>
<div id="total" class="box">Total: R$ 0,00</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQiJKegPY4bCrxIoKZ474PblFGF8mPHQWBNldXFobO36GitnPw3wuyDT_65YYp2HwBCFZ2FnViKtYwo/pub?gid=0&single=true&output=csv";

function parseCSV(text) {
  const rows = [];
  let cur = "", row = [], inQuotes = false;
  for (let i = 0; i < text.length; i++) {
    const ch = text[i], nxt = text[i+1];
    if (ch === '"') {
      if (inQuotes && nxt === '"') { cur += '"'; i++; }
      else inQuotes = !inQuotes;
    } else if (ch === ',' && !inQuotes) {
      row.push(cur); cur = "";
    } else if ((ch === '\n' || ch === '\r') && !inQuotes) {
      if (ch === '\r' && nxt === '\n') i++;
      row.push(cur); rows.push(row);
      row = []; cur = "";
    } else {
      cur += ch;
    }
  }
  if (cur !== "" || row.length > 0) { row.push(cur); rows.push(row); }
  return rows.map(r => r.map(c => (c||"").trim()));
}

function normalizarValor(texto) {
  if (!texto) return null;
  const t = texto.toString().trim();
  if (t === "" || t.toLowerCase().includes("s/cart")) return null;
  const limpo = t.replace(/[R$\s]/g, "").replace(".", "").replace(",", ".");
  const num = parseFloat(limpo);
  return isNaN(num) ? null : num;
}

function formatarMoeda(v) {
  if (v === null) return "-";
  return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
}

let dadosPlanos = [];
let dadosServicos = [];

function atualizarTotal() {
  let totalCartao = 0;
  let totalBoleto = 0;

  const planoSelecionado = document.getElementById("planoSelect").value;
  if (planoSelecionado !== "") {
    const idx = parseInt(planoSelecionado);
    totalCartao += dadosPlanos[idx].cartao || 0;
    totalBoleto += dadosPlanos[idx].boleto || 0;
  }

  document.querySelectorAll("input[name='servico']:checked").forEach(chk => {
    const idx = chk.value;
    totalCartao += dadosServicos[idx].cartao || 0;
    totalBoleto += dadosServicos[idx].boleto || 0;
  });

  document.getElementById("total").innerHTML = 
    `ðŸ’³ Total no CartÃ£o: ${formatarMoeda(totalCartao)}<br>ðŸ“„ Total no Boleto: ${formatarMoeda(totalBoleto)}`;
}

async function carregarCSV() {
  const el = document.getElementById("saida");
  el.innerHTML = "Carregando...";
  try {
    const resp = await fetch(CSV_URL);
    if (!resp.ok) throw new Error("Falha ao buscar CSV");
    const text = await resp.text();
    const rows = parseCSV(text);

    const planos = rows.slice(2, 13);
    const servicos = rows.slice(16, 29);

    dadosPlanos = planos.map(r => ({
      nome: r[0] || "",
      cartao: normalizarValor(r[1]),
      boleto: normalizarValor(r[2])
    })).filter(x => x.nome);

    dadosServicos = servicos.map(r => ({
      nome: r[0] || "",
      cartao: normalizarValor(r[1]),
      boleto: normalizarValor(r[2])
    })).filter(x => x.nome);

    let html = "<h2>Planos de Internet</h2>";
    html += `<select id="planoSelect" onchange="atualizarTotal()">
              <option value="">-- Selecione um plano --</option>`;
    dadosPlanos.forEach((p, i) => {
      html += `<option value="${i}">${p.nome} | ðŸ’³ ${formatarMoeda(p.cartao)} | ðŸ“„ ${formatarMoeda(p.boleto)}</option>`;
    });
    html += `</select>`;

    html += "<h2>ServiÃ§os Digitais</h2>";
    dadosServicos.forEach((s, i) => {
      html += `<div class="item">
        <label>
          <input type="checkbox" name="servico" value="${i}" onchange="atualizarTotal()"> 
          <strong>${s.nome}</strong>
        </label>
        <div class="precos">ðŸ’³ ${formatarMoeda(s.cartao)} | ðŸ“„ ${formatarMoeda(s.boleto)}</div>
      </div>`;
    });

    el.innerHTML = html;
    document.getElementById("last").textContent = "Ãšltima atualizaÃ§Ã£o: " + new Date().toLocaleString("pt-BR");
    atualizarTotal();

  } catch (err) {
    el.innerHTML = `<div class="error">Erro: ${err.message}</div>`;
  }
}

carregarCSV();
</script>
</body>
</html>
